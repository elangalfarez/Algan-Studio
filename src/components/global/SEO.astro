---
// src/components/global/SEO.astro
// Created: Dynamic SEO meta tags, Open Graph, Twitter Cards, and Schema.org markup

import { SITE_CONFIG } from '../../lib/constants';

interface Props {
  title: string;
  description: string;
  image?: string;
  canonicalUrl: string;
  noIndex?: boolean;
  type?: 'website' | 'article';
  publishedTime?: string;
  modifiedTime?: string;
  author?: string;
  section?: string;
  tags?: string[];
}

const {
  title,
  description,
  image = '/images/og-image.jpg',
  canonicalUrl,
  noIndex = false,
  type = 'website',
  publishedTime,
  modifiedTime,
  author,
  section,
  tags = [],
} = Astro.props;

const fullImageUrl = image.startsWith('http')
  ? image
  : `${SITE_CONFIG.url}${image}`;

// Organization Schema
const organizationSchema = {
  '@context': 'https://schema.org',
  '@type': 'Organization',
  name: SITE_CONFIG.name,
  url: SITE_CONFIG.url,
  logo: `${SITE_CONFIG.url}/images/logo.svg`,
  description: SITE_CONFIG.description,
  address: {
    '@type': 'PostalAddress',
    streetAddress: SITE_CONFIG.address.street,
    addressLocality: SITE_CONFIG.address.city,
    addressRegion: SITE_CONFIG.address.state,
    postalCode: SITE_CONFIG.address.zip,
    addressCountry: SITE_CONFIG.address.country,
  },
  contactPoint: {
    '@type': 'ContactPoint',
    telephone: SITE_CONFIG.phone,
    email: SITE_CONFIG.email,
    contactType: 'customer service',
  },
  sameAs: [
    SITE_CONFIG.social.instagram,
    SITE_CONFIG.social.linkedin,
    SITE_CONFIG.social.twitter,
    SITE_CONFIG.social.youtube,
  ],
  foundingDate: SITE_CONFIG.founded.toString(),
};

// Local Business Schema
const localBusinessSchema = {
  '@context': 'https://schema.org',
  '@type': 'ProfessionalService',
  name: SITE_CONFIG.name,
  url: SITE_CONFIG.url,
  image: `${SITE_CONFIG.url}/images/og-image.jpg`,
  telephone: SITE_CONFIG.phone,
  email: SITE_CONFIG.email,
  address: {
    '@type': 'PostalAddress',
    streetAddress: SITE_CONFIG.address.street,
    addressLocality: SITE_CONFIG.address.city,
    addressRegion: SITE_CONFIG.address.state,
    postalCode: SITE_CONFIG.address.zip,
    addressCountry: 'ID',
  },
  openingHoursSpecification: [
    {
      '@type': 'OpeningHoursSpecification',
      dayOfWeek: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'],
      opens: '09:00',
      closes: '18:00',
    },
    {
      '@type': 'OpeningHoursSpecification',
      dayOfWeek: 'Saturday',
      opens: '09:00',
      closes: '14:00',
    },
  ],
  priceRange: '$$',
};

// WebPage Schema
const webPageSchema = {
  '@context': 'https://schema.org',
  '@type': type === 'article' ? 'Article' : 'WebPage',
  name: title,
  description: description,
  url: canonicalUrl,
  image: fullImageUrl,
  ...(type === 'article' && {
    headline: title,
    datePublished: publishedTime,
    dateModified: modifiedTime || publishedTime,
    author: {
      '@type': 'Person',
      name: author || 'Algan Studio',
    },
    publisher: {
      '@type': 'Organization',
      name: SITE_CONFIG.name,
      logo: {
        '@type': 'ImageObject',
        url: `${SITE_CONFIG.url}/images/logo.svg`,
      },
    },
    mainEntityOfPage: {
      '@type': 'WebPage',
      '@id': canonicalUrl,
    },
    ...(section && { articleSection: section }),
    ...(tags.length > 0 && { keywords: tags.join(', ') }),
  }),
};

// BreadcrumbList Schema (basic, can be enhanced per page)
const breadcrumbSchema = {
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  itemListElement: [
    {
      '@type': 'ListItem',
      position: 1,
      name: 'Home',
      item: SITE_CONFIG.url,
    },
  ],
};
---

<!-- Primary Meta Tags -->
<title>{title}</title>
<meta name="title" content={title} />
<meta name="description" content={description} />
<link rel="canonical" href={canonicalUrl} />

{noIndex && <meta name="robots" content="noindex, nofollow" />}

<!-- Open Graph / Facebook -->
<meta property="og:type" content={type} />
<meta property="og:url" content={canonicalUrl} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:image" content={fullImageUrl} />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:site_name" content={SITE_CONFIG.name} />
<meta property="og:locale" content="en_US" />

{type === 'article' && publishedTime && (
  <>
    <meta property="article:published_time" content={publishedTime} />
    {modifiedTime && <meta property="article:modified_time" content={modifiedTime} />}
    {author && <meta property="article:author" content={author} />}
    {section && <meta property="article:section" content={section} />}
    {tags.map((tag) => <meta property="article:tag" content={tag} />)}
  </>
)}

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:url" content={canonicalUrl} />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={fullImageUrl} />
<meta name="twitter:site" content="@alganstudio" />
<meta name="twitter:creator" content="@alganstudio" />

<!-- Additional SEO Meta Tags -->
<meta name="author" content={author || SITE_CONFIG.name} />
<meta name="publisher" content={SITE_CONFIG.name} />
<meta name="generator" content={Astro.generator} />

<!-- Geo Meta Tags for local SEO -->
<meta name="geo.region" content="ID-JK" />
<meta name="geo.placename" content="Jakarta" />
<meta name="geo.position" content="-6.2088;106.8456" />
<meta name="ICBM" content="-6.2088, 106.8456" />

<!-- Language alternatives (for future multi-language) -->
<link rel="alternate" hreflang="en" href={canonicalUrl} />
<link rel="alternate" hreflang="x-default" href={canonicalUrl} />

<!-- Schema.org JSON-LD -->
<script type="application/ld+json" set:html={JSON.stringify(organizationSchema)} />
<script type="application/ld+json" set:html={JSON.stringify(localBusinessSchema)} />
<script type="application/ld+json" set:html={JSON.stringify(webPageSchema)} />
<script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />