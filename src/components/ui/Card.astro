---
// src/components/ui/Card.astro
// Created: Versatile card with hover effects, 3D tilt, and image support

interface Props {
  variant?: 'default' | 'elevated' | 'outline' | 'ghost';
  hover?: 'lift' | 'tilt' | 'glow' | 'none';
  padding?: 'none' | 'sm' | 'md' | 'lg';
  href?: string;
  image?: string;
  imageAlt?: string;
  imagePosition?: 'top' | 'left' | 'right' | 'background';
  aspectRatio?: 'auto' | 'square' | 'video' | '4/3';
  class?: string;
}

const {
  variant = 'default',
  hover = 'lift',
  padding = 'md',
  href,
  image,
  imageAlt = '',
  imagePosition = 'top',
  aspectRatio = 'auto',
  class: className,
} = Astro.props;

const isLink = !!href;
const Tag = isLink ? 'a' : 'div';

// Base styles
const baseStyles = [
  'block rounded-2xl overflow-hidden',
  'transition-all duration-[var(--duration-normal)]',
];

// Variant styles
const variantStyles = {
  default: 'bg-[color:var(--color-bg-tertiary)] border border-[color:var(--color-border)]',
  elevated: 'bg-[color:var(--color-bg-tertiary)] shadow-[var(--shadow-md)]',
  outline: 'bg-transparent border-2 border-[color:var(--color-border-strong)]',
  ghost: 'bg-transparent',
};

// Hover styles
const hoverStyles = {
  lift: 'hover:-translate-y-1 hover:shadow-[var(--shadow-lg)]',
  tilt: 'card-tilt',
  glow: 'hover:shadow-[var(--shadow-accent-lg)]',
  none: '',
};

// Padding styles
const paddingStyles = {
  none: '',
  sm: 'p-4',
  md: 'p-6',
  lg: 'p-8',
};

// Aspect ratio for images
const aspectStyles = {
  auto: '',
  square: 'aspect-square',
  video: 'aspect-video',
  '4/3': 'aspect-[4/3]',
};

// Layout styles based on image position
const layoutStyles = {
  top: 'flex flex-col',
  left: 'flex flex-row',
  right: 'flex flex-row-reverse',
  background: 'relative',
};

const allStyles = [
  ...baseStyles,
  variantStyles[variant],
  hover !== 'none' && hoverStyles[hover],
  image && imagePosition !== 'background' && 'p-0',
  imagePosition && layoutStyles[imagePosition],
  isLink && 'cursor-pointer focus:outline-none focus:ring-2 focus:ring-[color:var(--color-accent)] focus:ring-offset-2',
  className,
].filter(Boolean);

// Content padding when there's an image
const contentPadding = image && imagePosition !== 'background' ? paddingStyles[padding] : '';
const noImagePadding = !image ? paddingStyles[padding] : '';
---

{isLink ? (
  <a href={href} class:list={allStyles} data-card-hover={hover}>
    {image && imagePosition !== 'background' && (
      <div class:list={[
        'card-image overflow-hidden',
        imagePosition === 'top' && 'w-full',
        (imagePosition === 'left' || imagePosition === 'right') && 'w-1/3 flex-shrink-0',
        aspectStyles[aspectRatio],
      ]}>
        <img
          src={image}
          alt={imageAlt}
          class="w-full h-full object-cover transition-transform duration-[var(--duration-moderate)] group-hover:scale-105"
          loading="lazy"
          decoding="async"
        />
      </div>
    )}
    
    {image && imagePosition === 'background' && (
      <>
        <div class="absolute inset-0">
          <img
            src={image}
            alt=""
            class="w-full h-full object-cover"
            loading="lazy"
            decoding="async"
            aria-hidden="true"
          />
          <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent"></div>
        </div>
        <div class:list={['relative z-10 text-white', paddingStyles[padding]]}>
          <slot />
        </div>
      </>
    )}
    
    {(!image || imagePosition !== 'background') && (
      <div class:list={[contentPadding, noImagePadding, 'flex-1']}>
        <slot />
      </div>
    )}
  </a>
) : (
  <div class:list={allStyles} data-card-hover={hover}>
    {image && imagePosition !== 'background' && (
      <div class:list={[
        'card-image overflow-hidden',
        imagePosition === 'top' && 'w-full',
        (imagePosition === 'left' || imagePosition === 'right') && 'w-1/3 flex-shrink-0',
        aspectStyles[aspectRatio],
      ]}>
        <img
          src={image}
          alt={imageAlt}
          class="w-full h-full object-cover transition-transform duration-[var(--duration-moderate)]"
          loading="lazy"
          decoding="async"
        />
      </div>
    )}
    
    {image && imagePosition === 'background' && (
      <>
        <div class="absolute inset-0">
          <img
            src={image}
            alt=""
            class="w-full h-full object-cover"
            loading="lazy"
            decoding="async"
            aria-hidden="true"
          />
          <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent"></div>
        </div>
        <div class:list={['relative z-10 text-white', paddingStyles[padding]]}>
          <slot />
        </div>
      </>
    )}
    
    {(!image || imagePosition !== 'background') && (
      <div class:list={[contentPadding, noImagePadding, 'flex-1']}>
        <slot />
      </div>
    )}
  </div>
)}

<style>
  /* 3D Tilt effect */
  .card-tilt {
    transform-style: preserve-3d;
    perspective: 1000px;
  }
  
  /* Image zoom on hover */
  [data-card-hover]:hover .card-image img {
    transform: scale(1.05);
  }
  
  /* Subtle inner glow on tilt cards */
  .card-tilt::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(
      ellipse at var(--glow-x, 50%) var(--glow-y, 50%),
      rgba(255, 255, 255, 0.15) 0%,
      transparent 50%
    );
    opacity: 0;
    transition: opacity var(--duration-fast) var(--ease-out);
    pointer-events: none;
    border-radius: inherit;
    z-index: 1;
  }
  
  .card-tilt:hover::before {
    opacity: 1;
  }
  
  @media (prefers-reduced-motion: reduce) {
    .card-tilt {
      transform: none !important;
    }
    
    .card-tilt::before {
      display: none;
    }
    
    [data-card-hover]:hover .card-image img {
      transform: none;
    }
  }
</style>

<script>
  function initTiltCards() {
    const cards = document.querySelectorAll('.card-tilt');
    
    cards.forEach((card) => {
      const cardEl = card as HTMLElement;
      
      cardEl.addEventListener('mousemove', (e: MouseEvent) => {
        const rect = cardEl.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;
        
        // Calculate rotation (max 5 degrees)
        const rotateX = ((y - centerY) / centerY) * -5;
        const rotateY = ((x - centerX) / centerX) * 5;
        
        // Calculate glow position
        const glowX = (x / rect.width) * 100;
        const glowY = (y / rect.height) * 100;
        
        cardEl.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.02, 1.02, 1.02)`;
        cardEl.style.setProperty('--glow-x', `${glowX}%`);
        cardEl.style.setProperty('--glow-y', `${glowY}%`);
      });
      
      cardEl.addEventListener('mouseleave', () => {
        cardEl.style.transform = '';
      });
    });
  }
  
  initTiltCards();
  document.addEventListener('astro:page-load', initTiltCards);
</script>