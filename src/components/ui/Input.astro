---
// src/components/ui/Input.astro
// Created: Form input with floating label, validation states, and icons

interface Props {
  type?: 'text' | 'email' | 'password' | 'tel' | 'url' | 'number' | 'search';
  name: string;
  label: string;
  placeholder?: string;
  value?: string;
  required?: boolean;
  disabled?: boolean;
  readonly?: boolean;
  autocomplete?: string;
  pattern?: string;
  minlength?: number;
  maxlength?: number;
  min?: number;
  max?: number;
  step?: number;
  error?: string;
  hint?: string;
  size?: 'sm' | 'md' | 'lg';
  variant?: 'default' | 'filled';
  iconLeft?: boolean;
  iconRight?: boolean;
  class?: string;
}

const {
  type = 'text',
  name,
  label,
  placeholder = ' ',
  value = '',
  required = false,
  disabled = false,
  readonly = false,
  autocomplete,
  pattern,
  minlength,
  maxlength,
  min,
  max,
  step,
  error,
  hint,
  size = 'md',
  variant = 'default',
  iconLeft = false,
  iconRight = false,
  class: className,
} = Astro.props;

const inputId = `input-${name}`;
const errorId = `${inputId}-error`;
const hintId = `${inputId}-hint`;

// Size styles
const sizeStyles = {
  sm: {
    input: 'h-[var(--input-height-sm)] text-sm px-3',
    label: 'text-xs',
    iconSize: 'w-4 h-4',
    iconPadding: 'pl-9',
    iconRightPadding: 'pr-9',
  },
  md: {
    input: 'h-[var(--input-height-md)] text-sm px-4',
    label: 'text-sm',
    iconSize: 'w-5 h-5',
    iconPadding: 'pl-11',
    iconRightPadding: 'pr-11',
  },
  lg: {
    input: 'h-[var(--input-height-lg)] text-base px-5',
    label: 'text-base',
    iconSize: 'w-5 h-5',
    iconPadding: 'pl-12',
    iconRightPadding: 'pr-12',
  },
};

// Variant styles
const variantStyles = {
  default: 'bg-[color:var(--color-bg-tertiary)] border border-[color:var(--color-border)]',
  filled: 'bg-[color:var(--color-bg-secondary)] border-b-2 border-[color:var(--color-border-strong)] rounded-t-lg rounded-b-none',
};

const currentSize = sizeStyles[size];

const inputStyles = [
  'w-full rounded-xl',
  'text-[color:var(--color-text-primary)]',
  'placeholder:text-transparent',
  'transition-all duration-[var(--duration-fast)]',
  'focus:outline-none focus:border-[color:var(--color-accent)] focus:ring-2 focus:ring-[color:var(--color-accent-subtle)]',
  'disabled:opacity-50 disabled:cursor-not-allowed',
  'read-only:bg-[color:var(--color-bg-secondary)]',
  variantStyles[variant],
  currentSize.input,
  iconLeft && currentSize.iconPadding,
  iconRight && currentSize.iconRightPadding,
  error && 'border-[color:var(--color-error)] focus:border-[color:var(--color-error)] focus:ring-[color:var(--color-error-bg)]',
];
---

<div class:list={['input-wrapper relative', className]}>
  <!-- Input container -->
  <div class="relative">
    <!-- Left icon slot -->
    {iconLeft && (
      <div class:list={[
        'absolute left-3 top-1/2 -translate-y-1/2 text-[color:var(--color-text-muted)] pointer-events-none',
        currentSize.iconSize,
      ]}>
        <slot name="icon-left" />
      </div>
    )}
    
    <!-- Input field -->
    <input
      type={type}
      id={inputId}
      name={name}
      value={value}
      placeholder={placeholder}
      required={required}
      disabled={disabled}
      readonly={readonly}
      autocomplete={autocomplete}
      pattern={pattern}
      minlength={minlength}
      maxlength={maxlength}
      min={min}
      max={max}
      step={step}
      class:list={inputStyles}
      aria-invalid={error ? 'true' : undefined}
      aria-describedby={error ? errorId : hint ? hintId : undefined}
      data-input
    />
    
    <!-- Floating label -->
    <label
      for={inputId}
      class:list={[
        'floating-label',
        'absolute left-4 top-1/2 -translate-y-1/2',
        'text-[color:var(--color-text-muted)]',
        'pointer-events-none',
        'transition-all duration-[var(--duration-fast)]',
        'origin-left',
        currentSize.label,
        iconLeft && 'left-11',
        error && 'text-[color:var(--color-error)]',
      ]}
    >
      {label}
      {required && <span class="text-[color:var(--color-error)] ml-0.5" aria-hidden="true">*</span>}
    </label>
    
    <!-- Right icon slot or validation indicator -->
    {iconRight && (
      <div class:list={[
        'absolute right-3 top-1/2 -translate-y-1/2 text-[color:var(--color-text-muted)]',
        currentSize.iconSize,
      ]}>
        <slot name="icon-right" />
      </div>
    )}
    
    <!-- Validation icon -->
    {error && !iconRight && (
      <div class:list={[
        'absolute right-3 top-1/2 -translate-y-1/2 text-[color:var(--color-error)]',
        currentSize.iconSize,
      ]}>
        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-full h-full">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </div>
    )}
    
    <!-- Focus indicator line (for filled variant) -->
    {variant === 'filled' && (
      <div class="focus-line absolute bottom-0 left-0 right-0 h-0.5 bg-[color:var(--color-accent)] scale-x-0 origin-center transition-transform duration-[var(--duration-fast)]"></div>
    )}
  </div>
  
  <!-- Error message -->
  {error && (
    <p 
      id={errorId} 
      class="mt-1.5 text-xs text-[color:var(--color-error)] flex items-center gap-1"
      role="alert"
    >
      <svg class="w-3.5 h-3.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <span>{error}</span>
    </p>
  )}
  
  <!-- Hint text -->
  {hint && !error && (
    <p id={hintId} class="mt-1.5 text-xs text-[color:var(--color-text-muted)]">
      {hint}
    </p>
  )}
</div>

<style>
  /* Floating label animation */
  .input-wrapper input:focus + .floating-label,
  .input-wrapper input:not(:placeholder-shown) + .floating-label {
    transform: translateY(-130%) scale(0.85);
    background: var(--color-bg-tertiary);
    padding: 0 0.25rem;
    left: 0.75rem !important;
  }
  
  /* Filled variant label positioning */
  .input-wrapper input[class*="rounded-t-lg"]:focus + .floating-label,
  .input-wrapper input[class*="rounded-t-lg"]:not(:placeholder-shown) + .floating-label {
    background: var(--color-bg-secondary);
  }
  
  /* Focus line for filled variant */
  .input-wrapper input:focus ~ .focus-line {
    transform: scaleX(1);
  }
  
  /* Input autofill styling */
  .input-wrapper input:-webkit-autofill,
  .input-wrapper input:-webkit-autofill:hover,
  .input-wrapper input:-webkit-autofill:focus {
    -webkit-box-shadow: 0 0 0 1000px var(--color-bg-tertiary) inset;
    -webkit-text-fill-color: var(--color-text-primary);
    caret-color: var(--color-text-primary);
  }
  
  /* Error shake animation */
  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
    20%, 40%, 60%, 80% { transform: translateX(2px); }
  }
  
  .input-wrapper:has(input[aria-invalid="true"]) {
    animation: shake 0.4s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
  }
  
  @media (prefers-reduced-motion: reduce) {
    .input-wrapper:has(input[aria-invalid="true"]) {
      animation: none;
    }
  }
</style>